---
title: "Exploring the BRFSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(reshape2)
```

### Load data

```{r load-data}
load("brfss2013.RData")
```



* * *

## Part 1: Data

I investigated these questions using the BRFSS dataset. The BRFSS is a telephone survey that collects data on U.S. residents regarding health-related information.

## Generalizability

The CDC reports that the "[*survey is conducted using Random Digit Dialing (RDD) techniques on both landlines and cell phones*](https://www.cdc.gov/brfss/about/brfss_faq.htm)". Since a random sampling method used, results may be generalized to the U.S. population.

Note that there may be response bias as people who respond to telephone surveys may have different characteristics (*e.g.* people who respond to telephone surveys may be less likely to be employed full-time).

## Causality

We cannot determine causality in our analysis because random assignment was not used.

* * *

## Part 2: Research questions

**Research Question 1:**
Do men or women have on average more than one drink per day?

**Research Question 2 (3 variables):**
Of the subset of adults who are veterans, is there a relationship between the number of days mental health was not good and the number of days that physical health was not good?

**Research Question 3 (3 Variables):**
Are there differences in the number of hours of sleep by gender or age?

* * *

## Part 3: Exploratory data analysis

## Research Question 1 - EDA

As an initial step, let's identify all of the variables that contain information related to alcohol use.
```{r}
grep("drnk", names(brfss2013), value = TRUE)
```

We found that the variables listed below are related to alcohol use. These variables come from an "optional" section of the survey, so there are many observations with missing values. Additionally, survey respondents may underreport their alcohol usage. All of these variables are measures of alcohol use in the last 30 days.

* `avedrnk2` - Average alcoholic drinks per day
* `drnk3ge5` - Number of binge drinking occasions (men: 5+ drinks, women: 4+ drinks).
* `maxdrnks` - Most drinks on a single occasion.
* `drnkany5` - Drink any alcoholic beverages.
Calculated variables:
* `X_drnkdy4` - Total number of alcoholic beverages consumed per day
* `X_drnkmo4` - Total number of alcoholic beverages consumed per month

The calculated variable `X_drnkdy4` looks interesting. We can create a new variable (named `X_drnkdy_1plus`) to segment the population into adults who have on average one or more drink a day vs. adults who have less than one drink a day.

```{r}
brfss2013 <- brfss2013 %>% mutate (One_or_More_Drink_Per_Day = ifelse(X_drnkdy4 >= 1, "Yes", "No"))
```

Now that we've created a new categorical field, let's check the distribution of the population.

```{r}
brfss2013 %>% group_by(One_or_More_Drink_Per_Day) %>% summarise(count=n())
```
It looks like about half the population has on average 1 or more drink per day while the other half has on average less than 1 drink per day.

Let's filter out observations where gender or alcohol consumption was not reported.

```{r}
gender_alcohol <- brfss2013 %>% filter(sex != "NA", One_or_More_Drink_Per_Day != "NA")
```

Now that we've prepared the data, we can generate plots and summary statistics.

## Research Question 1 - Plot

```{r question1_plot}
ggplot(data = gender_alcohol, aes(x = sex, fill = One_or_More_Drink_Per_Day)) +
  geom_bar() +
  ggtitle("Number of Males & Females segmented by Daily Alcohol Consumption") +
  scale_y_continuous(name="# of Respondents", labels = scales::comma) +
  scale_x_discrete(name="Gender")
```

It looks like the majority of men have more than 1 drink per day on average, whereas less than half of females have more than 1 drink per day on average.

## Research Question 1 - Summary Statistics

```{r question_1_summary_statistics} 
gender_alcohol %>% group_by(sex, One_or_More_Drink_Per_Day) %>% summarise(count=n(), percent_of_total = n()/467893)
```

Note that the percentages shown in the summary statistics above are out of the total respondents (men and women) and not each gender specifically. The differences in alcohol consumption may be due to both the frequency of ocassions where alcohol is consumed, as well as the quantity of alcohol consumed during each individual ocassion.

## Research Question 2 - EDA

First, we need to filter for respondents who are veterans.

```{r}
veterans <- brfss2013 %>% filter(veteran3 == "Yes")
```

There were 491,775 in our original dataset, of which 61,446 were veterans.

Next, we check for extreme values by grouping by ``menthlth`` value.

```{r}
veterans %>% group_by(menthlth) %>% summarise(count=n())
veterans %>% group_by(physhlth) %>% summarise(count=n())
```

We see that there is one observation for ``menthlth`` that has a value of ``5000`` and one observation for ``physhlth`` that has a value of ``60``. The codebook defines these fields as *how many days during the past 30 days...*. Therefor, values greater than 30 are not reasonable so we will exclude these observations as well as any ``NA`` values.

```{r}
veterans <- veterans %>% filter(menthlth <= 30, physhlth <=30)
```

Now that we have excluded the unreasonable extreme values and ``NA`` values, we can plot the data to see if there is a relationship. Because there are still a large number of observations, we can filter for only the mental/physical health relationships that have a large number of observations.

```{r}
veterans_phys_ment <- veterans %>% group_by(physhlth, menthlth) %>% summarise(count=n())
```

Because we are working with discrete variables rather than continuous variables, it can be difficult to observe trends in a scatter plot. For visibility, we'll filter only for mental/physical health ratings that had at least 50 observations.

## Research Question 2 - Plot

```{r question2_plot}
ggplot(data = veterans_phys_ment %>%
  filter(count > 50), aes(x = physhlth, y = menthlth, size = count)) +
  geom_point() +
  ggtitle("Relationship between \nMental & Physical Health of Veterans") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("# Days \nPhysical Health Not Good") +
  ylab("# Days \nMental Health Not Good")
```

It looks like there is a weak positive correlation between the number of days that mental health and physical health were reported as not good. Most of the observations are located on the edges, meaning that there were many veterans who reported 0 days of bad mental and/or physical health or all 30 days of bad mental and/or physical health.

## Research Question 2 - Summary Statistics

```{r question_2_summary_statistics}
veterans %>% summarise (mean_mental_notgood_days = mean(menthlth), median_mental_notgood_days = median(menthlth),      mean_physical_notgood_days = mean(physhlth), median_physical_notgood_days = median(physhlth))
```

Based on the summary statistics, it looks like veterans report more days of not good physical health compared to mental health.

## Research Question 3 - EDA

First, we want to look at the population by gender and age. 

```{r}
brfss2013 %>% group_by(sex) %>% summarise(count=n())
brfss2013 %>% group_by(X_age80) %>% summarise(count=n())
brfss2013 %>% group_by(sleptim1) %>% summarise(count=n())
```

The survey was collected for adults (*i.e. people who were 18 years or older*), so we can filter out the five observations that had ages of 0-3. Additionally, ages above 80 were "collapsed" into a single group. We will exclude those as well since we don't have their exact ages. Lastly, we'll find the average hours slept for each age.

```{r}
age_gender_sleep <- brfss2013 %>% filter(X_age80 <= 80, X_age80 >= 18, sex != 'NA', sleptim1<=24)
age_gender_avg_sleep <- age_gender_sleep %>% group_by(sex, X_age80) %>% summarise(mean_hours_slept = mean(sleptim1))

age_gender_avg_sleep_joined <- cbind(age_gender_avg_sleep %>% filter (sex == "Male"), age_gender_avg_sleep %>% filter (sex == "Female"))
# Rename columns
colnames(age_gender_avg_sleep_joined)[colnames(age_gender_avg_sleep_joined)=="mean_hours_slept"] <- "male_mean_hours_slept"
colnames(age_gender_avg_sleep_joined)[colnames(age_gender_avg_sleep_joined)=="mean_hours_slept1"] <- "female_mean_hours_slept"

# Remove extra columns
age_gender_avg_sleep_joined <- subset(age_gender_avg_sleep_joined, select = -c(sex, sex1, X_age801))

# Transform data in order to plot
age_gender_avg_sleep_long <- melt(age_gender_avg_sleep_joined, id="X_age80")
```

## Research Question 3 - Plot

```{r question_3_plot}
ggplot(data = age_gender_avg_sleep_long, aes(x=X_age80, y=value, color=variable)) +
  geom_line() +
  scale_colour_manual(values=c("blue", "red")) +
  ggtitle("Hours of Sleep by Age and Gender") +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab("Age (Years)") +
  ylab("Average # Hours of Sleep")
```

Overall it looks respondents between the ages of 30-55 get the least amount of sleep, but respondents that are over age 55 get more sleep. It also looks like women in most age groups sleep more on average than men in the same age groups.

## Research Question 3 - Summary Statistics

```{r}
age_gender_avg_sleep_joined %>% summarise(mean(male_mean_hours_slept), median(male_mean_hours_slept))
```
```{r}
age_gender_avg_sleep_joined %>% summarise(mean(female_mean_hours_slept), median(female_mean_hours_slept))
```

The summary statistics align with the graph showing that females have on average more sleep than men when aggregated across age groups.

# Conclusion

These preliminary analyses show cursory exploration of several variables from the BRFSS dataset. The visualizations aided in identifying trends, however, these do not imply causality since the data was not collected through random sampling.

Further areas of exploration would include analyzing trends by state and integrating data on public health spending to identify instances where health spending was low but reported health was good.